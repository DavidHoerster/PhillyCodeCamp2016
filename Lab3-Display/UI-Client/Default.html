<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - My ASP.NET Application</title>
    <link rel="stylesheet" href="Content\bootstrap.min.css" />
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                Baseball Stats-enator
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li>Home</li>
                    <li>About</li>
                    <li>Contact</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container body-content">

        <h2>Batter Stats</h2>
        <div>
            <p>Player ID: <input type="text" id="id" />  <button id="search">Search</button></p>
        </div>
        <div class="container">
            ID: <span id='playerId'></span> <br />
            Name: <span id="name"></span><br/>
            Hits: <span id='hits'></span><br />
            Average: <span id='avg'></span><br />
            On Base: <span id='obp'></span><br />
            Slugging: <span id='slg'></span><br />
        </div>
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - My ASP.NET Application</p>
        </footer>
    </div>
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery-1.10.2.min.js"></script>
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="http://localhost:57000/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            $.connection.hub.url = "http://localhost:57000/signalr";

            // Reference the auto-generated proxy for the hub.
            var batters = $.connection.batterHub,
                $id = $('#playerId'),
                $name = $('#name'),
                $hits = $('#hits'),
                $avg = $('#avg'),
                $obp = $('#obp'),
                $slg = $('#slg');

            function init() {
                $("#search").click(function (e) {
                    var id = $("#id").val();
                    e.preventDefault();
                    
                    $.getJSON("http://localhost:57000/api/player/" + id)
                        .success(function (data) {
                            $id.text(data.name.Id);
                            $name.text(data.name.FullName);
                            $hits.text(data.stats.Hits);
                            $avg.text(data.stats.Average);
                            $obp.text(data.stats.OnBase);
                            $slg.text(data.stats.Slugging);

                            batters.server.subscribe(data.name.Id).done(function () { });
                        })
                })
                //batters.server.subscribe("@ViewBag.Id").done(function(){});
            }

            // Create a function that the hub can call back to display messages.
            batters.client.updateStats = function (stats) {
                $hits.text(stats.Hits);
                $avg.text(stats.Average);
                $obp.text(stats.OnBase);
                $slg.text(stats.Slugging);
            }
            // Start the connection.
            $.connection.hub.start().done(init);
        });
    </script>
</body>
</html>
